---
tags:
  - k3s
  - architecture
  - homelab
created: 2025-01-15
---

# K3s — Архитектура кластера

Схема моего HA кластера [[K3s]].

## Топология

```
                    ┌─────────────────────────────┐
                    │      Virtual IP (VIP)       │
                    │      192.168.20.225         │
                    │    управляется kube-vip     │
                    └─────────────┬───────────────┘
                                  │
        ┌─────────────────────────┼─────────────────────────┐
        │                         │                         │
        ▼                         ▼                         ▼
┌───────────────┐       ┌───────────────┐       ┌───────────────┐
│   polynode-1  │       │   polynode-2  │       │   polynode-3  │
│192.168.20.221 │       │192.168.20.222 │       │192.168.20.223 │
│───────────────│       │───────────────│       │───────────────│
│ K3s Server    │◄─────►│ K3s Server    │◄─────►│ K3s Server    │
│ + Agent       │ etcd  │ + Agent       │ etcd  │ + Agent       │
│ + etcd        │ sync  │ + etcd        │ sync  │ + etcd        │
│ + kube-vip    │       │ + kube-vip    │       │ + kube-vip    │
└───────────────┘       └───────────────┘       └───────────────┘
```

**Железо:** [[Dell OptiPlex 3050]] | Intel Core i5-7500T | RAM 8GB | SSD 256GB

## Компоненты

| Компонент | Описание |
|-----------|----------|
| **K3s Server** | Control plane: API Server, Controller Manager, Scheduler |
| **K3s Agent** | Worker: kubelet, kube-proxy |
| **Embedded etcd** | Распределённая БД состояния (кворум 2 из 3) |
| **[[kube-vip]]** | Virtual IP для отказоустойчивого доступа к API |

## Требуемые порты

| Порт | Протокол | Назначение |
|------|----------|------------|
| 6443 | TCP | Kubernetes API server |
| 2379 | TCP | etcd client |
| 2380 | TCP | etcd peer |
| 10250 | TCP | Kubelet metrics |
| 8472 | UDP | Flannel VXLAN |

## Планируемое расширение

```
                         VIP 192.168.20.225
                                │
        ┌───────────────────────┼───────────────────────┐
        │                       │                       │
        ▼                       ▼                       ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│  polynode-1   │     │  polynode-2   │     │  polynode-3   │
│    Server     │     │    Server     │     │    Server     │
│  +Agent+etcd  │     │  +Agent+etcd  │     │  +Agent+etcd  │
└───────────────┘     └───────────────┘     └───────────────┘
        │                       │                       │
        └───────────────────────┼───────────────────────┘
                                │
              ┌─────────────────┼─────────────────┐
              ▼                                   ▼
      ┌───────────────┐                   ┌───────────────┐
      │  RTX A6000    │                   │  Jetson Nano  │
      │  Agent only   │                   │  Agent only   │
      │  label: gpu   │                   │  label: edge  │
      └───────────────┘                   └───────────────┘
```

## См. также

- [[K3s]]
- [[K3s - Установка HA]]
- [[kube-vip]]
